# HTTP-services Personal аccount (1.1.3.5)

## Оглавление
- [Общее](#общее)

- [Ping](#ping)

- [Approval of repairs](#approval-of-repairs)

***

## Общее

Во всех сервисах:

**_TransactionID_** - уникальный GUID для каждого обращения. Используется для логирования.

**_SourceID_** - уникальный GUID системы, которая обращается к сервису. Необходим, для идентификации источника запроса и не должен часто меняться.


## Ping
### Описание
Предназначен для проверки доступности сервиса.

Метод - **GET**

### Описание шаблона
**_URL_**: 
```html
    https://<domen>.ru/<base>/hs/PersAcc/ping/
```
Возвращает _JSON_ с следующими параметрами элемента _response_:

| Параметры                |    Тип                  | Обязательный | Описание                         |
| ------------------------ | :---------------------: | :----------: | :------------------------------- |
| result                   |    Строка               | Да           | Возвращает "ок" при успешном соединении
| ver                      |    Строка               | Да           | Возвращает строковое представление версии API


### Пример

**Ответ в формате _JSON_**: 
```json
    {
        "response": {
            "result": "ok",
            "ver": "1.1.1.1",
        }
    }
```

***

## Approval of repairs
### Описание
Предназначен для согласования/отмены согласования заказ-наряда в 1С по переданному GUID.

Метод - **PUT**

### Описание шаблона
**_URL_**: 
```html
    https://<server>/PersAcc/repairs/approval/{guid}
```
где guid уникальный идентификатор заказ-наряда (строка 36 знаков)

Тело запроса содержит _JSON_ с следующими параметрами:

| Параметры                |    Тип                  | Обязательный | Описание                         |
| ------------------------ | :---------------------: | :----------: | :------------------------------- |
| TransactionID            |    Строка (36)          | Нет          | [См. общее](#общее)
| SourceID                 |    Строка (36)          | Да           | [См. общее](#общее)
| Approval                 |    Булево               | Да           | Признак действия - согласовать документ или отменить согласование


Тело ответа содержит _JSON_ с следующими параметрами элемента _response_:

| Параметры                |    Тип                  | Обязательный | Описание                         |
| ------------------------ | :---------------------: | :----------: | :------------------------------- |
| TransactionID            |    Строка (36)          | Нет          | [См. общее](#общее)
| SourceID                 |    Строка (36)          | Да           | [См. общее](#общее)
| OrderStatus              |    Строка               | Да           | Статус заказ-наряда после согласования или отмены согласованиясогласование
| NewOrderGUIDDocument     |    Строка (36)          | Да           | GUID заказ наряда на диагностику (создается при отмене согласования)


### Пример

**_URL_**: 
```html
https://<server>/PersAcc/repairs/approval/79ad8c9e-e3be-11eb-b9a8-04d9f5ae0304  
```

**Тело запроса в формате _JSON_**:
```json
    {
        "TransactionID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c64",
        "SourceID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c64",
        "Approval": true
    }
```

**Ответ в формате _JSON_**: 
```json
    {
        "response": {
            "TransactionID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c64",
            "SourceID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c70",
            "OrderStatus": "Ожидает оплаты",
            "NewOrderGUIDDocument": "0d2fd304-07ef-4f32-9a76-2b7d820e2c80"
        },
        "error": null,
        "errorCode": null
    }
```

***

## Files
### Описание
Предназначен для получения двоичных данных изображений из 1С по переданному GUID
Метод - PUT

### Описание шаблона
**_URL_**: 
```html
https://<server>/PersAcc/files/{type}/{guid}
```
где guid уникальный идентификатор заказ-наряда (строка 36 знаков)

Тело запроса содержит _JSON_ с следующими параметрами:

| Параметры                |    Тип                  | Обязательный | Описание                         |
| ------------------------ | :---------------------: | :----------: | :------------------------------- |
| TransactionID            |    Строка (36)          | Нет          | [См. общее](#общее)
| SourceID                 |    Строка (36)          | Да           | [См. общее](#общее)

Если успешно, то возвращаются двоичные данные иначе тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                |    Тип                  | Обязательный | Описание                         |
| ------------------------ | :---------------------: | :----------: | :------------------------------- |
| response                 |    Null                 | Да           | Не заполняется при ошибки
| error                    |    Строка               | Да           | Строка описания ошибки
| errorCode                |    Строка               | Да           | Код ошибки в классификации API согласованиясогласование


### Пример

**_URL_**: 
```html
https://<server>/PersAcc/files/ClientObject/f41acb2d-79f8-11ed-81af-00155df43007 
```

**Тело запроса в формате _JSON_**:
```json
{
    "TransactionID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c64",
    "SourceID": "0d2fd304-07ef-4f32-9a76-2b7d820e2c64"
}
```

**Ответ в формате _JSON_**: 
Двоичные данные или
```json
{
    "response": null,
    "error": "Не удалось получить двоичные данные. Возможно передан некорректный идентификатор (guid)",
    "errorCode": "ErrSearch"
}
```
